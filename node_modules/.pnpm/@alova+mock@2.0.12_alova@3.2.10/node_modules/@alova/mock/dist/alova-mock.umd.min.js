!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AlovaMock={})}(this,(function(e){"use strict";const t="undefined",r=Promise,s=Object,o=void 0,n=!0,a=!1,c=e=>typeof e;typeof window===t&&typeof process!==t&&process.cwd;const i=e=>"function"===c(e),u=e=>"string"===c(e),p=e=>s.prototype.toString.call(e),l=e=>{const t=p(e);return/^\[object (Blob|FormData|ReadableStream|URLSearchParams)\]$/i.test(t)||(r=ArrayBuffer,e instanceof r);var r};const d=(e,...t)=>new e(...t),f="color: black; font-size: 12px; font-weight: bolder",h=e=>{const t={};for(const r in e)t[r]={value:e[r]};return t},m=({isMock:e,url:t,method:r,headers:s,query:o,data:n,responseHeaders:a,response:c})=>{const i=console;i.groupCollapsed("%c"+(e?"mock":"Realtime"),`padding: 2px 6px; background: ${e?"#ccefff":"#ededed"}; color: ${e?"#64bde8":"#999999"};`,t),i.log("%c[Method]",f,r.toUpperCase()),i.log("%c[Request Headers]",f),i.table(h(s)),i.log("%c[Query String Parameters]",f),i.table(h(o)),i.log("%c[Request Body]",f,n||""),e&&(Object.keys(a).length>0&&(i.log("%c[Response Headers]",f),i.table(h(a))),i.log("%c[Response Body]",f,c||"")),i.groupEnd()},b=({status:e=200,responseHeaders:t,statusText:r="ok",body:s})=>({response:new Response(l(s)?s:JSON.stringify(s),{status:e,statusText:r}),headers:new Headers(t)}),y=e=>e;function g({enable:e=true,delay:t=2e3,httpAdapter:s,mockRequestLogger:l=m,mock:f,onMockResponse:h=b,onMockError:g=y,matchMode:T="pathname"}={mock:{}}){return(m,b)=>{f=e&&f||{};const{url:y,data:k,type:E,headers:q}=m;let w=b.url,R=b.config.params||{};if("pathname"===T){const e=(e=>{const t=(e=/^[^/]*\/\//.test(e)?e:`//${e}`).split("/").slice(3),r={};let s=t.pop(),o="",n="";return s&&(s=s.replace(/\?[^?#]+/,(e=>(e.substring(1).split("&").forEach((e=>{const[t,s]=e.split("=");t&&(r[t]=s)})),""))),s=s.replace(/#[^#]*/,(e=>(n=e,""))),t.push(s),o=`/${t.join("/")}`),{pathname:o,query:r,hash:n}})(y);w=e.pathname,R=e.query}const v={},x=w.split("/"),H=Object.keys(f).filter((e=>{if(e.startsWith("-"))return a;let t="GET";if(e=e.replace(/^\[(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|TRACE|CONNECT)\]/i,((e,r)=>(t=r.toUpperCase(),""))),t!==E.toUpperCase())return a;const r=e.split("/");if(r.length!==x.length)return a;for(let e=0;e<r.length;e+=1){const t=r[e],s=(t.match(/^\{(.*)\}$/)||["",""])[1];if(s)v[s]=x[e];else if(t!==x[e])return a}return n}));let j=H.find((e=>!/\{.*\}/.test(e)));j=j||H.shift();const M=j?f[j]:o;if(M===o){if(s)return i(l)&&l({isMock:a,url:y,method:E,params:v,headers:q,query:R,data:{},responseHeaders:{}}),s(m,b);throw new Error(`cannot find the httpAdapter.\n[url]${y}`)}const P=function(){let e,t;return{promise:new Promise(((r,s)=>{e=r,t=s})),resolve:e,reject:t}}(),{resolve:A}=P;let{promise:C,reject:O}=P;const N=b.config.timeout||0;N>0&&setTimeout((()=>{O(new Error("request timeout"))}),N);const S=setTimeout((()=>{try{const e=i(M)?M({query:R,params:v,data:u(k)||!k?{}:k,headers:q}):M;A(d(Promise,((t,s)=>{var o;O=s,(o=e,r.resolve(o)).then(t).catch(s)})))}catch(e){O(e)}}),t);return C=C.then((e=>{let t=200,r="ok",s={},a=o;var p;return e===o?(t=404,r="api not found"):e&&(p=e.status,"number"===c(p)&&!Number.isNaN(p))&&u(e.statusText)?(t=e.status,r=e.statusText,s=e.responseHeaders||s,a=e.body):a=e,d(Promise,((e,o)=>{try{e(h({status:t,statusText:r,responseHeaders:s,body:a},{headers:q,query:R,params:v,data:k||{}},b))}catch(e){o(e)}})).then((e=>(i(l)&&l({isMock:n,url:y,method:E,params:v,headers:q,query:R,data:k||{},responseHeaders:s,response:a}),e)))})).catch((e=>{return t=g(e,b),r.reject(t);var t})),{response:()=>C.then((({response:e})=>e&&"[object Response]"===p(e)?e.clone():e)),headers:()=>C.then((({headers:e})=>e)),abort:()=>{clearTimeout(S),O(new Error("The user abort request"))}}}}e.createAlovaMockAdapter=function(e,t={enable:!0}){let r={};return e.filter((({enable:e})=>e)).forEach((({data:e})=>{r={...e,...r}})),g({...t,mock:r})},e.defineMock=(e,t=!0)=>({enable:t,data:e})}));
